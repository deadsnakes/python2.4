From: Felix Krull <f_krull@gmx.de>
Date: Fri, 27 Apr 2018 08:06:22 -0700
Subject: gcc-fwrapv

# DP: use -fwrapv when GCC supports it.
---
 configure.in | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/configure.in b/configure.in
index f0b37bb..1f233c2 100644
--- a/configure.in
+++ b/configure.in
@@ -752,6 +752,10 @@ if test -z "$OPT"
 then
     case $GCC in
     yes)
+        # For gcc 4.x we need to use -fwrapv so lets check if its supported
+        if "$CC" -v --help 2>/dev/null |grep -- -fwrapv > /dev/null; then
+           WRAP="-fwrapv"
+        fi
 	case $ac_cv_prog_cc_g in
 	yes)
 	    if test "$Py_DEBUG" = 'true' ; then
@@ -759,11 +763,11 @@ then
 		# debug builds.
 		OPT="-g -Wall -Wstrict-prototypes"
 	    else
-		OPT="-g -O3 -Wall -Wstrict-prototypes"
+		OPT="-g $WRAP -O3 -Wall -Wstrict-prototypes"
 	    fi
 	    ;;
 	*)
-	    OPT="-O3 -Wall -Wstrict-prototypes"
+	    OPT="$WRAP -O3 -Wall -Wstrict-prototypes"
 	    ;;
 	esac
 	case $ac_sys_system in
